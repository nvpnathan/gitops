piVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: go-reminders-test-
spec:
  entrypoint: go-reminders-test
  templates:
  - name: test
    steps:
    # Run Golang tests for the Application
    - - name: test
        template: test
    # evaluate the result in parallel
    - - name: ok
        template: ok                 # cantinue workflow if test results "ok"
        when: "{{steps.test.outputs.result}} == ok"
      - name: fail
        template: fail                # exit fail workflow if test results "fail"
        when: "{{steps.test.outputs.result}} == fail"

  # Return ok or fail from _test files
  - name: test
    script:
      image: python:alpine3.6
      command: [python]
      source: |
        import random
	import sys
        result = "heads" if random.randint(0,1) == 0 else "tails"
        print(result)

  - name: ok
    container:
      image: alpine:3.6
      command: [sh, -c]
      args: ["echo \"Test results were ok, continuing to Docker build \""]

  - name: fail
    container:
      image: alpine:3.6
      command: [sh, -c]
      args: ["echo \"Go Unit tests Failed, cancelling workflow\""]
